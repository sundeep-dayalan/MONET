{"version":3,"sources":["../src/index.tsx"],"sourcesContent":["import {\n\ttype MutationFunction,\n\ttype QueryFunction,\n\ttype QueryKey,\n\ttype UseMutationOptions,\n\ttype UseQueryOptions,\n\tuseMutation,\n\tuseQuery,\n\tuseQueryClient,\n} from '@tanstack/react-query'\nimport React from 'react'\n\nexport interface ReactQueryAuthConfig<User, LoginCredentials, RegisterCredentials> {\n\tuserFn: QueryFunction<User, QueryKey>\n\tloginFn: MutationFunction<User, LoginCredentials>\n\tregisterFn: MutationFunction<User, RegisterCredentials>\n\tlogoutFn: MutationFunction<unknown, unknown>\n\tuserKey?: QueryKey\n}\n\nexport interface AuthProviderProps {\n\tchildren: React.ReactNode\n}\n\nexport function configureAuth<User, Error, LoginCredentials, RegisterCredentials>(\n\tconfig: ReactQueryAuthConfig<User, LoginCredentials, RegisterCredentials>\n) {\n\tconst { userFn, userKey = ['authenticated-user'], loginFn, registerFn, logoutFn } = config\n\n\tconst useUser = (options?: Omit<UseQueryOptions<User, Error, User, QueryKey>, 'queryKey' | 'queryFn'>) =>\n\t\tuseQuery({\n\t\t\tqueryKey: userKey,\n\t\t\tqueryFn: userFn,\n\t\t\t...options,\n\t\t})\n\n\tconst useLogin = (options?: Omit<UseMutationOptions<User, Error, LoginCredentials>, 'mutationFn'>) => {\n\t\tconst queryClient = useQueryClient()\n\n\t\tconst setUser = React.useCallback((data: User) => queryClient.setQueryData(userKey, data), [queryClient])\n\n\t\treturn useMutation({\n\t\t\tmutationFn: loginFn,\n\t\t\t...options,\n\t\t\tonSuccess: (user, ...rest) => {\n\t\t\t\tsetUser(user)\n\t\t\t\toptions?.onSuccess?.(user, ...rest)\n\t\t\t},\n\t\t})\n\t}\n\n\tconst useRegister = (options?: Omit<UseMutationOptions<User, Error, RegisterCredentials>, 'mutationFn'>) => {\n\t\tconst queryClient = useQueryClient()\n\n\t\tconst setUser = React.useCallback((data: User) => queryClient.setQueryData(userKey, data), [queryClient])\n\n\t\treturn useMutation({\n\t\t\tmutationFn: registerFn,\n\t\t\t...options,\n\t\t\tonSuccess: (user, ...rest) => {\n\t\t\t\tsetUser(user)\n\t\t\t\toptions?.onSuccess?.(user, ...rest)\n\t\t\t},\n\t\t})\n\t}\n\n\tconst useLogout = (options?: UseMutationOptions<unknown, Error, unknown>) => {\n\t\tconst queryClient = useQueryClient()\n\n\t\tconst setUser = React.useCallback((data: User | null) => queryClient.setQueryData(userKey, data), [queryClient])\n\n\t\treturn useMutation({\n\t\t\tmutationFn: logoutFn,\n\t\t\t...options,\n\t\t\tonSuccess: (...args) => {\n\t\t\t\tsetUser(null)\n\t\t\t\toptions?.onSuccess?.(...args)\n\t\t\t},\n\t\t})\n\t}\n\n\tfunction AuthLoader({\n\t\tchildren,\n\t\trenderLoading,\n\t\trenderUnauthenticated,\n\t\trenderError = (error: Error) => <>{JSON.stringify(error)}</>,\n\t}: {\n\t\tchildren: React.ReactNode\n\t\trenderLoading: () => JSX.Element\n\t\trenderUnauthenticated?: () => JSX.Element\n\t\trenderError?: (error: Error) => JSX.Element\n\t}) {\n\t\tconst { isSuccess, isFetched, status, data, error } = useUser()\n\n\t\tif (isSuccess) {\n\t\t\tif (renderUnauthenticated && !data) {\n\t\t\t\treturn renderUnauthenticated()\n\t\t\t}\n\t\t\treturn <>{children}</>\n\t\t}\n\n\t\tif (!isFetched) {\n\t\t\treturn renderLoading()\n\t\t}\n\n\t\tif (status === 'error') {\n\t\t\treturn renderError(error)\n\t\t}\n\n\t\treturn null\n\t}\n\n\treturn {\n\t\tuseUser,\n\t\tuseLogin,\n\t\tuseRegister,\n\t\tuseLogout,\n\t\tAuthLoader,\n\t}\n}\n"],"mappings":";AAAA;AAAA,EAMC;AAAA,EACA;AAAA,EACA;AAAA,OACM;AACP,OAAO,WAAW;AA2EgB;AA7D3B,SAAS,cACf,QACC;AACD,QAAM,EAAE,QAAQ,UAAU,CAAC,oBAAoB,GAAG,SAAS,YAAY,SAAS,IAAI;AAEpF,QAAM,UAAU,CAAC,YAChB,SAAS;AAAA,IACR,UAAU;AAAA,IACV,SAAS;AAAA,IACT,GAAG;AAAA,EACJ,CAAC;AAEF,QAAM,WAAW,CAAC,YAAoF;AACrG,UAAM,cAAc,eAAe;AAEnC,UAAM,UAAU,MAAM,YAAY,CAAC,SAAe,YAAY,aAAa,SAAS,IAAI,GAAG,CAAC,WAAW,CAAC;AAExG,WAAO,YAAY;AAAA,MAClB,YAAY;AAAA,MACZ,GAAG;AAAA,MACH,WAAW,CAAC,SAAS,SAAS;AAC7B,gBAAQ,IAAI;AACZ,iBAAS,YAAY,MAAM,GAAG,IAAI;AAAA,MACnC;AAAA,IACD,CAAC;AAAA,EACF;AAEA,QAAM,cAAc,CAAC,YAAuF;AAC3G,UAAM,cAAc,eAAe;AAEnC,UAAM,UAAU,MAAM,YAAY,CAAC,SAAe,YAAY,aAAa,SAAS,IAAI,GAAG,CAAC,WAAW,CAAC;AAExG,WAAO,YAAY;AAAA,MAClB,YAAY;AAAA,MACZ,GAAG;AAAA,MACH,WAAW,CAAC,SAAS,SAAS;AAC7B,gBAAQ,IAAI;AACZ,iBAAS,YAAY,MAAM,GAAG,IAAI;AAAA,MACnC;AAAA,IACD,CAAC;AAAA,EACF;AAEA,QAAM,YAAY,CAAC,YAA0D;AAC5E,UAAM,cAAc,eAAe;AAEnC,UAAM,UAAU,MAAM,YAAY,CAAC,SAAsB,YAAY,aAAa,SAAS,IAAI,GAAG,CAAC,WAAW,CAAC;AAE/G,WAAO,YAAY;AAAA,MAClB,YAAY;AAAA,MACZ,GAAG;AAAA,MACH,WAAW,IAAI,SAAS;AACvB,gBAAQ,IAAI;AACZ,iBAAS,YAAY,GAAG,IAAI;AAAA,MAC7B;AAAA,IACD,CAAC;AAAA,EACF;AAEA,WAAS,WAAW;AAAA,IACnB;AAAA,IACA;AAAA,IACA;AAAA,IACA,cAAc,CAAC,UAAiB,gCAAG,eAAK,UAAU,KAAK,GAAE;AAAA,EAC1D,GAKG;AACF,UAAM,EAAE,WAAW,WAAW,QAAQ,MAAM,MAAM,IAAI,QAAQ;AAE9D,QAAI,WAAW;AACd,UAAI,yBAAyB,CAAC,MAAM;AACnC,eAAO,sBAAsB;AAAA,MAC9B;AACA,aAAO,gCAAG,UAAS;AAAA,IACpB;AAEA,QAAI,CAAC,WAAW;AACf,aAAO,cAAc;AAAA,IACtB;AAEA,QAAI,WAAW,SAAS;AACvB,aAAO,YAAY,KAAK;AAAA,IACzB;AAEA,WAAO;AAAA,EACR;AAEA,SAAO;AAAA,IACN;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EACD;AACD;","names":[]}